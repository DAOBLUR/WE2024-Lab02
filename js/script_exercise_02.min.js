const display=document.querySelector("#display"),buttons=document.querySelectorAll("button"),history=document.querySelector("#history");let IsEnabled=!0,OperatorEnabled=!1,DotEnabled=!0,LeftParenCount=0;buttons.forEach(n=>{n.onclick=()=>{if("copy"===n.id)CopyEntryToClipboard();else if(IsEnabled)if("backspace"==n.id){var e=display.innerText.toString();display.innerText=e.substr(0,e.length-1),DotEnabled=!DotEnabled,OperatorEnabled=!OperatorEnabled}else if("clean"==n.id)display.innerText="",OperatorEnabled=!1,DotEnabled=!0;else if("equal"==n.id&&""!=display.innerText)try{Equal()}catch(e){display.innerText="Error",IsEnabled=!1,setTimeout(()=>{display.innerText="",IsEnabled=!0},2e3)}else""==display.innerText&&"equal"==n.id?(display.innerText="Null",setTimeout(()=>{display.innerText="",IsEnabled=!0},2e3)):16<=display.innerText.length||("leftParen"==n.id?(display.innerText+="(",LeftParenCount++):"rightParen"==n.id&&0<LeftParenCount?(display.innerText+=")",OperatorEnabled=!0,LeftParenCount--):"mod"==n.id&&OperatorEnabled?(display.innerText+="%",OperatorEnabled=!1):"pi"==n.id?(0===display.innerText.length?display.innerText+="π":display.innerText+="xπ",OperatorEnabled=!0):"division"==n.id&&OperatorEnabled?(display.innerText+="/",OperatorEnabled=!1):"multiplication"==n.id&&OperatorEnabled?(display.innerText+="x",OperatorEnabled=!1):"squareRoot"==n.id&&""!=display.innerText?display.innerText="√("+display.innerText+")":"squared"!=n.id||""==display.innerText||display.innerText.includes("²")?"subtraction"==n.id&&OperatorEnabled?(display.innerText+="-",OperatorEnabled=!1):"addition"==n.id&&OperatorEnabled?(display.innerText+="+",OperatorEnabled=!1):"point"==n.id&&DotEnabled?(display.innerText+=".",DotEnabled=!1):"percentage"==n.id&&""!=display.innerText?display.innerText="("+display.innerText+")/100":n.id in["0","1","2","3","4","5","6","7","8","9"]&&(display.innerText+=n.id,OperatorEnabled=!0,DotEnabled=!0):display.innerText="("+display.innerText+")²")}}),document.addEventListener("keydown",function(e){if(IsEnabled){e=e.key;if("Backspace"==e){var n=display.innerText.toString();display.innerText=n.substr(0,n.length-1),DotEnabled=!DotEnabled,OperatorEnabled=!OperatorEnabled}else if("c"==e.toLowerCase())display.innerText="",OperatorEnabled=!1,DotEnabled=!0;else if("enter"==e.toLowerCase()&&""!=display.innerText)try{Equal()}catch(e){display.innerText="Error",IsEnabled=!1,setTimeout(()=>{display.innerText="",IsEnabled=!0},2e3)}else""==display.innerText&&"enter"==e.toLowerCase()?(display.innerText="Null",setTimeout(()=>{display.innerText="",IsEnabled=!0},2e3)):16<=display.innerText.length||("("==e?(display.innerText+="(",LeftParenCount++):")"==e&&0<LeftParenCount?(display.innerText+=")",OperatorEnabled=!0,LeftParenCount--):"m"==e.toLowerCase()&&OperatorEnabled?(display.innerText+="%",OperatorEnabled=!1):"p"==e.toLowerCase()?(0===display.innerText.length?display.innerText+="π":display.innerText+="xπ",OperatorEnabled=!0):"/"==e&&OperatorEnabled?(display.innerText+="/",OperatorEnabled=!1):"*"==e&&OperatorEnabled?(display.innerText+="x",OperatorEnabled=!1):"r"==e.toLowerCase()&&""!=display.innerText?display.innerText="√("+display.innerText+")":"s"!=e.toLowerCase()||""==display.innerText||display.innerText.includes("²")?"-"==e&&OperatorEnabled?(display.innerText+="-",OperatorEnabled=!1):"+"==e&&OperatorEnabled?(display.innerText+="+",OperatorEnabled=!1):"."==e&&DotEnabled?(display.innerText+=".",DotEnabled=!1):"%"==e&&""!=display.innerText?display.innerText="("+display.innerText+")/100":e in["0","1","2","3","4","5","6","7","8","9"]&&(display.innerText+=e,OperatorEnabled=!0,DotEnabled=!0):display.innerText="("+display.innerText+")²")}});const themeToggleBtn=document.querySelector(".theme-toggler"),calculator=document.querySelector(".calculator");let isDark=!0;function Equal(){if("Null"!=display.innerText){if(0<LeftParenCount)for(;0<LeftParenCount;)display.innerText+=")",LeftParenCount--;var allOperation=display.innerText;AddRowInHistory(allOperation),allOperation=allOperation.replaceAll("√","Math.sqrt"),allOperation=ReplaceNestedPow(allOperation),allOperation=allOperation.replaceAll("mod","%"),allOperation=allOperation.replaceAll("x","*"),allOperation=allOperation.replaceAll("π",Math.PI),display.innerText=eval(allOperation)}}function ReplaceNestedPow(e){var n=/\(([^()]+)\)²/g;let t=e,a=null;for(;a!==t;)t=(a=t).replace(n,"Math.pow($1,2)");return t}themeToggleBtn.onclick=()=>{calculator.classList.toggle("dark"),themeToggleBtn.classList.toggle("active"),isDark=!isDark};let historyCount=0;function AddRowInHistory(e){history.innerHTML+=NewDiv(e),historyCount++}function LoadHistory(e){display.innerText=e}function DeleteHistory(e){document.getElementById(e).remove()}function CopyToClipboard(e){navigator.clipboard.writeText(e),alert("Copied text")}function CopyEntryToClipboard(){0!=display.innerText.length&&(navigator.clipboard.writeText(display.innerText),alert("Copied text"))}function NewDiv(e){return`<div class="row m-0 p-0 history-row" id="history-row-${historyCount}">
            <p class="col-8 my-auto mx-2">${e}</p>
            <button class="col-1 my-auto m-0 p-0 my-auto me-1 text-success" onclick="CopyToClipboard('${e}')">
                <span class="material-symbols-outlined">content_copy</span>
            </button>
            <button class="col-1 my-auto m-0 p-0 my-auto me-1 text-primary" onclick="LoadHistory('${e}')">
                <span class="material-symbols-outlined">history</span>
            </button>
            <button class="col-1 my-auto m-0 p-0 my-auto ms-1 text-danger" onclick="DeleteHistory('history-row-${historyCount}')">
                <span class="material-symbols-outlined">delete</span>
            </button>
        </div>`}